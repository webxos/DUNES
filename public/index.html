<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vial MCP Controller</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        #terminal { position: absolute; bottom: 0; width: 100%; }
        #credentials-modal { display: none; }
    </style>
</head>
<body class="bg-gray-900 text-white font-mono">
    <!-- 3D Visualization -->
    <div id="three-js-container" class="w-full h-screen"></div>

    <!-- Terminal Interface -->
    <div id="terminal" class="bg-black bg-opacity-80 p-4">
        <div id="output" class="mb-2">
            <p>Vial MCP Controller initialized. Use /help for API commands.</p>
            <p>$WEBXOS Balance: 0.0000 | Reputation: 0</p>
        </div>
        <input id="command-input" type="text" class="w-full bg-transparent border-t border-gray-700 p-2 focus:outline-none" placeholder="Enter command (/help, /login, /train, etc.)">
    </div>

    <!-- API Credentials Modal -->
    <div id="credentials-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
        <div class="bg-gray-800 p-6 rounded-lg">
            <h2 class="text-lg mb-4">API Access Credentials</h2>
            <p id="api-key" class="mb-2">Key: [Generated Key]</p>
            <p id="api-secret" class="mb-4">Secret: [Generated Secret]</p>
            <button id="generate-credentials" class="bg-blue-600 px-4 py-2 rounded mr-2">Generate New Credentials</button>
            <button id="close-modal" class="bg-gray-600 px-4 py-2 rounded">Close</button>
        </div>
    </div>

    <!-- Command Buttons -->
    <div class="absolute top-4 right-4 flex space-x-2">
        <button id="auth-btn" class="bg-blue-600 px-4 py-2 rounded">Authenticate</button>
        <button id="void-btn" class="bg-red-600 px-4 py-2 rounded">Void</button>
        <button id="troubleshoot-btn" class="bg-yellow-600 px-4 py-2 rounded">Troubleshoot</button>
        <button id="quantum-btn" class="bg-purple-600 px-4 py-2 rounded">Quantum Link</button>
        <button id="export-btn" class="bg-green-600 px-4 py-2 rounded">Export</button>
        <button id="import-btn" class="bg-green-600 px-4 py-2 rounded">Import</button>
        <button id="api-access-btn" class="bg-blue-600 px-4 py-2 rounded">API Access</button>
    </div>

    <!-- Footer -->
    <footer class="absolute bottom-4 left-4 text-sm">
        WebXOS Vial MCP Controller | Offline Mode | 2025 | v2.7
    </footer>

    <script>
        // Three.js Setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('three-js-container').appendChild(renderer.domElement);

        // Simple 3D Cube for Visualization
        const geometry = new THREE.BoxGeometry();
        const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
        const cube = new THREE.Mesh(geometry, material);
        scene.add(cube);
        camera.position.z = 5;

        function animate() {
            requestAnimationFrame(animate);
            cube.rotation.x += 0.01;
            cube.rotation.y += 0.01;
            renderer.render(scene, camera);
        }
        animate();

        // Terminal Command Handling
        const commandInput = document.getElementById('command-input');
        const output = document.getElementById('output');
        commandInput.addEventListener('keypress', async (e) => {
            if (e.key === 'Enter') {
                const command = commandInput.value.trim();
                output.innerHTML += `<p>> ${command}</p>`;
                if (command === '/help') {
                    output.innerHTML += `<p>Available commands: /login, /train, /translate, /diagnose, /sync, /status, /wallet, /deploy</p>`;
                } else if (command === '/login') {
                    output.innerHTML += `<p>Authenticating... Please use the Authenticate button.</p>`;
                } else {
                    try {
                        const response = await fetch('http://localhost:8000/jsonrpc', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                jsonrpc: '2.0',
                                method: command.slice(1),
                                params: {},
                                id: 1
                            })
                        });
                        const result = await response.json();
                        output.innerHTML += `<p>${JSON.stringify(result)}</p>`;
                    } catch (error) {
                        output.innerHTML += `<p>Error: ${error.message}</p>`;
                    }
                }
                commandInput.value = '';
                output.scrollTop = output.scrollHeight;
            }
        });

        // Button Event Listeners
        document.getElementById('api-access-btn').addEventListener('click', () => {
            document.getElementById('credentials-modal').style.display = 'flex';
        });
        document.getElementById('close-modal').addEventListener('click', () => {
            document.getElementById('credentials-modal').style.display = 'none';
        });
        document.getElementById('generate-credentials').addEventListener('click', async () => {
            try {
                const response = await fetch('http://localhost:8000/auth/generate-credentials', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                const { key, secret } = await response.json();
                document.getElementById('api-key').textContent = `Key: ${key}`;
                document.getElementById('api-secret').textContent = `Secret: ${secret}`;
            } catch (error) {
                output.innerHTML += `<p>Error generating credentials: ${error.message}</p>`;
            }
        });

        // Resize Handler
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
